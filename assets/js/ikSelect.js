// ikSelect 0.9.4
// Copyright (c) 2012 Igor Kozlov
// i10k.ru
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function h(b,d){var e={};this.el=b,this.$el=a(b);for(var f in c)e[f]=this.$el.data(f.toLowerCase());this.options=a.extend({},c,d,e),a.browser.mobile&&(this.options.filter=!1),this.init()}var d,b=a(window),c={syntax:'<div class="ik_select_link"><div class="ik_select_link_text"></div></div><div class="ik_select_dropdown"><div class="ik_select_list"></div></div>',autoWidth:!0,ddFullWidth:!0,equalWidths:!0,dynamicWidth:!1,extractLink:!1,customClass:"",linkCustomClass:"",ddCustomClass:"",ddMaxHeight:200,extraWidth:0,filter:!1,nothingFoundText:"Nothing found",isDisabled:!1,onInit:function(){},onShow:function(){},onHide:function(){},onKeyUp:function(){},onKeyDown:function(){},onHoverMove:function(){}},e=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}};if(!a.browser){var f=e(navigator.userAgent),g={};f.browser&&(g[f.browser]=!0,g.version=f.version),g.chrome?g.webkit=!0:g.webkit&&(g.safari=!0),a.browser=g}a.browser.mobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile/i.test(navigator.userAgent),a.browser.operamini="[object OperaMini]"===Object.prototype.toString.call(window.operamini),a.extend(h.prototype,{init:function(){this.$wrapper=a('<div class="ik_select">'+this.options.syntax+"</div>"),this.$link=a(".ik_select_link",this.$wrapper),this.$linkText=a(".ik_select_link_text",this.$wrapper),this.$dropdown=a(".ik_select_dropdown",this.$wrapper),this.$list=a(".ik_select_list",this.$wrapper),this.$listInner=a('<div class="ik_select_list_inner"/>'),this.$active=a([]),this.$hover=a([]),this.hoverIndex=0,this.$optionSet=a([]),this.$optgroupSet=a([]),this.$list.append(this.$listInner),this.options.filter&&(this.$filter=a([]),this.$optionSetOriginal=a([]),this.$nothingFoundText=a('<div class="ik_select_nothing_found"/>').html(this.options.nothingFoundText),this.$filterWrap=a(".ik_select_filter_wrap",this.$wrapper),this.$filterWrap.length||(this.$filterWrap=a('<div class="ik_select_filter_wrap"/>')),this.$filter=a('<input type="text" class="ik_select_filter">'),this.$filterWrap.append(this.$filter),this.$list.prepend(this.$filterWrap),this.$filter.on({"keydown.ikSelect keyup.ikSelect":a.proxy(this,"_elKeyUpDown"),"keyup.ikSelect":a.proxy(this,"_filterKeyup")})),this.$wrapper.addClass(this.options.customClass),this.$link.addClass(this.options.linkCustomClass||this.options.customClass&&this.options.customClass+"-link"),this.$dropdown.addClass(this.options.ddCustomClass||this.options.customClass&&this.options.customClass+"-dd"),this.reset(),this.toggle(!(this.options.isDisabled||this.$el.prop("disabled"))),this.$link.on("click.ikSelect",a.proxy(this,"_linkClick")),this.$el.on({"focus.ikSelect":a.proxy(this,"_elFocus"),"blur.ikSelect":a.proxy(this,"_elBlur"),"change.ikSelect":a.proxy(this,"_syncOriginalOption"),"keydown.ikSelect keyup.ikSelect":a.proxy(this,"_elKeyUpDown")}),this.$list.on({"click.ikSelect":a.proxy(this,"_optionClick"),"mouseover.ikSelect":a.proxy(this,"_optionMouseover")},".ik_select_option"),this.$wrapper.on("click",function(){return!1}),this.$el.after(this.$wrapper),this.redraw(),this.$el.appendTo(this.$wrapper),this.options.onInit(this),this.$el.trigger("ikinit",this)},_linkClick:function(){this.isDisabled||(this===d?this.hideDropdown():this.showDropdown())},_optionClick:function(){this._makeOptionActive(this.searchIndexes?this.$optionSetOriginal.index(this.$hover):this.hoverIndex,!0),this.hideDropdown(),this.$el.change().focus()},_optionMouseover:function(b){var c=a(b.currentTarget);c.hasClass("ik_select_option_disabled")||(this.$hover.removeClass("ik_select_hover"),this.$hover=c.addClass("ik_select_hover"),this.hoverIndex=this.$optionSet.index(this.$hover))},_makeOptionActive:function(b,c){var d=a(this.el.options[b]);this.$linkText.text(d.text()),this.$link.toggleClass("ik_select_link_novalue",!d.attr("value")),this.$hover.removeClass("ik_select_hover"),this.$active.removeClass("ik_select_active"),this.$hover=this.$active=this.$optionSet.eq(b).addClass("ik_select_hover ik_select_active"),this.hoverIndex=b,c&&this._syncFakeOption()},_elKeyUpDown:function(b){var f,c=a(b.currentTarget),d=b.type,e=b.which;switch(e){case 38:"keydown"===d&&(b.preventDefault(),this._moveToPrevActive());break;case 40:"keydown"===d&&(b.preventDefault(),this._moveToNextActive());break;case 33:"keydown"===d&&(b.preventDefault(),f=this.$hover.position().top-this.$listInner.height(),this._moveToPrevActive(function(a){return f>=a}));break;case 34:"keydown"===d&&(b.preventDefault(),f=this.$hover.position().top+this.$listInner.height(),this._moveToNextActive(function(a){return a>=f}));break;case 36:"keydown"===d&&c.is(this.$el)&&(b.preventDefault(),this._moveToFirstActive());break;case 35:"keydown"===d&&c.is(this.$el)&&(b.preventDefault(),this._moveToLastActive());break;case 32:"keydown"===d&&c.is(this.$el)&&(b.preventDefault(),this.$dropdown.is(":visible")?this.$hover.click():this._linkClick());break;case 13:"keydown"===d&&this.$dropdown.is(":visible")&&(b.preventDefault(),this.$hover.click());break;case 27:"keydown"===d&&this.$dropdown.is(":visible")&&(b.preventDefault(),this.hideDropdown());break;case 9:"keydown"===d&&(a.browser.webkit&&this.$dropdown.is(":visible")?b.preventDefault():this.hideDropdown());break;default:"keyup"===d&&c.is(this.$el)&&this._syncOriginalOption()}"keyup"===d&&a.browser.mozilla&&this._syncFakeOption(),"keydown"===d&&(this.options.onKeyDown(this,e),this.$el.trigger("ikkeydown",[this,e])),"keyup"===d&&(this.options.onKeyUp(this,e),this.$el.trigger("ikkeyup",[this,e]))},_moveTo:function(b){var c,d,e;return!this.$dropdown.is(":visible")&&a.browser.webkit?(this.showDropdown(),this):(!this.$dropdown.is(":visible")||a.browser.mozilla?this._makeOptionActive(b,!0):(this.$hover.removeClass("ik_select_hover"),this.$hover=this.$optionSet.eq(b).addClass("ik_select_hover"),this.hoverIndex=b),c=this.$hover.position().top,d=c+this.$active.outerHeight(),this.$hover.index()||(e=this.$hover.closest(".ik_select_optgroup"),e.length&&(c=e.position().top)),d>this.$listInner.height()?this.$listInner.scrollTop(this.$listInner.scrollTop()+d-this.$listInner.height()):0>c&&this.$listInner.scrollTop(this.$listInner.scrollTop()+c),this.options.onHoverMove(this),void this.$el.trigger("ikhovermove",this))},_moveToFirstActive:function(){for(var a=0;a<this.$optionSet.length;a++)if(!this.$optionSet.eq(a).hasClass("ik_select_option_disabled")){this._moveTo(a);break}},_moveToLastActive:function(){for(var a=this.$optionSet.length-1;a>=0;a++)if(!this.$optionSet.eq(a).hasClass("ik_select_option_disabled")){this._moveTo(a);break}},_moveToPrevActive:function(a){for(var b,c=this.hoverIndex-1;c>=0;c--)if(b=this.$optionSet.eq(c),!b.hasClass("ik_select_option_disabled")&&("undefined"==typeof a||a(b.position().top))){this._moveTo(c);break}},_moveToNextActive:function(a){for(var b,c=this.hoverIndex+1;c<this.$optionSet.length;c++)if(b=this.$optionSet.eq(c),!b.hasClass("ik_select_option_disabled")&&("undefined"==typeof a||a(b.position().top))){this._moveTo(c);break}},_elFocus:function(){var a,c,d,e;return this.isDisabled?this:(this.$link.addClass("ik_select_link_focus"),a=this.$wrapper.offset().top,c=this.$wrapper.height(),d=b.scrollTop(),e=b.height(),void((a+c>d+e||d>a)&&b.scrollTop(a-e/2)))},_elBlur:function(){this.$link.removeClass("ik_select_link_focus")},_filterKeyup:function(){var c,b=a.trim(this.$filter.val());this.$listInner.show(),"undefined"==typeof this.searchIndexes&&(this.$optionSetOriginal=this.$optionSet,this.searchIndexes=a.makeArray(this.$optionSet.map(function(b,c){return a(c).text().toLowerCase()}))),b!==c&&(""===b?(this.$optionSet=this.$optionSetOriginal.show(),this.$optgroupSet.show(),this.$nothingFoundText.remove()):(this.$optionSet=a([]),this.$optgroupSet.show(),this.$optionSetOriginal.each(a.proxy(function(c,d){var e=a(d);this.searchIndexes[c].indexOf(b.toLowerCase())>=0?(this.$optionSet=this.$optionSet.add(e),e.show()):e.hide()},this)),this.$optionSet.length?(this.$nothingFoundText.remove(),this.$optgroupSet.each(function(b,c){var d=a(c);a(".ik_select_option:visible",d).length||d.hide()}),this.$hover.is(":visible")||this._moveToFirstActive()):(this.$listInner.hide(),this.$list.append(this.$nothingFoundText))),c=b)},_syncFakeOption:function(){this.el.selectedIndex=this.hoverIndex},_syncOriginalOption:function(){this._makeOptionActive(this.el.selectedIndex)},_fixHeight:function(){this.$dropdown.show(),this.$listInner.css("height","auto"),this.$listInner.height()>this.options.ddMaxHeight&&this.$listInner.css({overflow:"auto",height:this.options.ddMaxHeight,position:"relative"}),this.$dropdown.hide()},redraw:function(){var b,c,d;this.options.filter&&this.$filter.hide(),this.$wrapper.css({position:"relative"}),this.$dropdown.css({position:"absolute",zIndex:9998,width:"100%"}),this.$list.css({position:"relative"}),this._fixHeight(),(this.options.dynamicWidth||this.options.autoWidth||this.options.ddFullWidth)&&(this.$wrapper.width(""),this.$dropdown.show().width(9999),this.$listInner.css("float","left"),this.$list.css("float","left"),b=this.$list.outerWidth(!0)+(this.options.extraWidth||0),c=this.$listInner.width()-this.$listInnerUl.width(),this.$list.css("float",""),this.$listInner.css("float",""),this.$dropdown.css("width","100%"),this.options.ddFullWidth&&this.$dropdown.width(b+c),this.options.dynamicWidth?this.$wrapper.css({display:"inline-block",width:"auto",verticalAlign:"top"}):this.options.autoWidth&&this.$wrapper.width(b+(this.options.equalWidths?c:0)).addClass("ik_select_autowidth"),d=this.$wrapper.parent().width(),this.$wrapper.width()>d&&this.$wrapper.width(d)),this.options.filter&&this.$filter.show().outerWidth(this.$filterWrap.width()),this.$dropdown.hide(),this.$el.css({position:"absolute",margin:0,padding:0,top:0,left:-9999}),a.browser.mobile&&this.$el.css({opacity:0,left:0,height:this.$wrapper.height(),width:this.$wrapper.width()})},reset:function(){var b="";this.$linkText.html(this.$el.val()),this.$listInner.empty(),b="<ul>",this.$el.children().each(a.proxy(function(c,d){var g,e=a(d),f=d.tagName.toLowerCase();"optgroup"===f?(g=e.children().map(a.proxy(function(b,c){return this._generateOptionObject(a(c))},this)),g=a.makeArray(g),b+=this._renderListOptgroup({label:e.attr("label")||"&nbsp;",isDisabled:e.is(":disabled"),options:g})):"option"===f&&(b+=this._renderListOption(this._generateOptionObject(e)))},this)),b+="</ul>",this.$listInner.append(b),this._syncOriginalOption(),this.$listInnerUl=a("> ul",this.$listInner),this.$optgroupSet=a(".ik_select_optgroup",this.$listInner),this.$optionSet=a(".ik_select_option",this.$listInner)},hideDropdown:function(){this.options.filter&&(this.$filter.val(""),this._filterKeyup()),this.$dropdown.hide().appendTo(this.$wrapper).css({left:"",top:""}),this.options.extractLink&&(this.$wrapper.outerWidth(this.$wrapper.data("outerWidth")),this.$wrapper.height(""),this.$link.removeClass("ik_select_link_extracted").css({position:"",top:"",left:"",zIndex:""}).prependTo(this.$wrapper)),d=null,this.$el.focus(),this.options.onHide(this),this.$el.trigger("ikhide",this)},showDropdown:function(){var a,c,e,f,g,h,i,j,k;d!==this&&this.$optionSet.length&&(d&&d.hideDropdown(),this._syncOriginalOption(),this.$dropdown.show(),a=this.$dropdown.offset(),c=this.$dropdown.outerWidth(!0),e=this.$dropdown.outerHeight(!0),f=this.$wrapper.offset(),h=b.width(),i=b.height(),j=b.scrollTop(),this.options.ddFullWidth&&f.left+c>h&&(a.left=h-c),a.top+e>j+i&&(a.top=j+i-e),this.$dropdown.css({left:a.left,top:a.top,width:this.$dropdown.width()}).appendTo("body"),this.options.extractLink&&(k=this.$link.offset(),g=this.$wrapper.outerWidth(),this.$wrapper.data("outerWidth",g),this.$wrapper.outerWidth(g),this.$wrapper.outerHeight(this.$wrapper.outerHeight()),this.$link.outerWidth(this.$link.outerWidth()),this.$link.addClass("ik_select_link_extracted").css({position:"absolute",top:k.top,left:k.left,zIndex:9999}).appendTo("body")),this.$listInner.scrollTop(this.$active.position().top-this.$list.height()/2),this.options.filter?this.$filter.focus():this.$el.focus(),d=this,this.options.onShow(this),this.$el.trigger("ikshow",this))},_generateOptionObject:function(a){return{value:a.val(),label:a.html()||"&nbsp;",isDisabled:a.is(":disabled")}},_renderListOption:function(a){var b,c=a.isDisabled?" ik_select_option_disabled":"";return b='<li class="ik_select_option'+c+'" data-value="'+a.value+'">',b+='<span class="ik_select_option_label">',b+=a.label,b+="</span>",b+="</li>"},_renderListOptgroup:function(b){var c,d=b.isDisabled?" ik_select_optgroup_disabled":"";return c='<li class="ik_select_optgroup'+d+'">',c+='<div class="ik_select_optgroup_label">'+b.label+"</div>",c+="<ul>",a.isArray(b.options)&&a.each(b.options,a.proxy(function(a,b){c+=this._renderListOption({value:b.value,label:b.label||"&nbsp;",isDisabled:b.isDisabled})},this)),c+="</ul>",c+="</li>"},_renderOption:function(a){return'<option value="'+a.value+'">'+a.label+"</option>"},_renderOptgroup:function(b){var c;return c='<optgroup label="'+b.label+'">',a.isArray(b.options)&&a.each(b.options,a.proxy(function(a,b){c+=this._renderOption(b)},this)),c+="</option>"},addOptions:function(b,c,d){var i,j,e="",f="",g=this.$listInnerUl,h=this.$el;b=a.isArray(b)?b:[b],a.each(b,a.proxy(function(a,b){e+=this._renderListOption(b),f+=this._renderOption(b)},this)),a.isNumeric(d)&&d<this.$optgroupSet.length&&(g=this.$optgroupSet.eq(d),h=a("optgroup",this.$el).eq(d)),a.isNumeric(c)&&(i=a(".ik_select_option",g),c<i.length&&(i.eq(c).before(e),j=a("option",h),j.eq(c).before(f))),j||(g.append(e),h.append(f)),this.$optionSet=a(".ik_select_option",this.$listInner),this._fixHeight()},addOptgroups:function(b,c){var d="",e="";b&&(b=a.isArray(b)?b:[b],a.each(b,a.proxy(function(a,b){d+=this._renderListOptgroup(b),e+=this._renderOptgroup(b)},this)),a.isNumeric(c)&&c<this.$optgroupSet.length?(this.$optgroupSet.eq(c).before(d),a("optgroup",this.$el).eq(c).before(e)):(this.$listInnerUl.append(d),this.$el.append(e)),this.$optgroupSet=a(".ik_select_optgroup",this.$listInner),this.$optionSet=a(".ik_select_option",this.$listInner),this._fixHeight())},removeOptions:function(b,c){var e,f,d=a([]);a.isNumeric(c)&&(0>c?(e=a("> .ik_select_option",this.$listInnerUl),f=a("> option",this.$el)):c<this.$optgroupSet.length&&(e=a(".ik_select_option",this.$optgroupSet.eq(c)),f=a("optgroup",this.$el).eq(c).find("option"))),e||(e=this.$optionSet,f=a(this.el.options)),a.isArray(b)||(b=[b]),a.each(b,a.proxy(function(a,b){b<e.length&&(d=d.add(e.eq(b)).add(f.eq(b)))},this)),d.remove(),this.$optionSet=a(".ik_select_option",this.$listInner),this._syncOriginalOption(),this._fixHeight()},removeOptgroups:function(b){var c=a([]),d=a("optgroup",this.el);a.isArray(b)||(b=[b]),a.each(b,a.proxy(function(a,b){b<this.$optgroupSet.length&&(c=c.add(this.$optgroupSet.eq(b)).add(d.eq(b)))},this)),c.remove(),this.$optionSet=a(".ik_select_option",this.$listInner),this.$optgroupSet=a(".ik_select_optgroup",this.$listInner),this._syncOriginalOption(),this._fixHeight()},disable:function(){this.toggle(!1)},enable:function(){this.toggle(!0)},toggle:function(a){this.isDisabled="undefined"!=typeof a?!a:!this.isDisabled,this.$el.prop("disabled",this.isDisabled),this.$link.toggleClass("ik_select_link_disabled",this.isDisabled)},select:function(a,b){b?this.el.selectedIndex=a:this.$el.val(a),this._syncOriginalOption()},disableOptgroups:function(a){this.toggleOptgroups(a,!1)},enableOptgroups:function(a){this.toggleOptgroups(a,!0)},toggleOptgroups:function(b,c){a.isArray(b)||(b=[b]),a.each(b,a.proxy(function(b,d){var e,f,h,g=[],i=a("optgroup",this.$el).eq(d);e="undefined"!=typeof c?c:i.prop("disabled"),i.prop("disabled",!e),this.$optgroupSet.eq(d).toggleClass("ik_select_optgroup_disabled",!e),f=a("option",i),h=a(this.el.options).index(f.eq(0));for(var j=h;j<h+f.length;j++)g.push(j);this.toggleOptions(g,!0,e)},this)),this._syncOriginalOption()},disableOptions:function(a,b){this.toggleOptions(a,b,!1)},enableOptions:function(a,b){this.toggleOptions(a,b,!0)},toggleOptions:function(b,c,d){var e=a("option",this.el);a.isArray(b)||(b=[b]);var f=a.proxy(function(a,b){var c="undefined"!=typeof d?d:a.prop("disabled");a.prop("disabled",!c),this.$optionSet.eq(b).toggleClass("ik_select_option_disabled",!c)},this);a.each(b,function(b,d){c?f(e.eq(d),d):e.each(function(b,c){var e=a(c);return e.val()===d?(f(e,b),this):void 0})}),this._syncOriginalOption()},detach:function(){this.$el.off(".ikSelect").css({width:"",height:"",left:"",top:"",position:"",margin:"",padding:""}),this.$wrapper.before(this.$el),this.$wrapper.remove(),this.$el.removeData("plugin_ikSelect")}}),a.fn.ikSelect=function(b){var c;return a.browser.operamini?this:(c=Array.prototype.slice.call(arguments,1),this.each(function(){var d;a.data(this,"plugin_ikSelect")?"string"==typeof b&&(d=a.data(this,"plugin_ikSelect"),"function"==typeof d[b]&&d[b].apply(d,c)):a.data(this,"plugin_ikSelect",new h(this,b))}))},a.ikSelect={extendDefaults:function(b){a.extend(c,b)}},a(document).bind("click.ikSelect",function(){d&&d.hideDropdown()})});


$(function () {
  $('.iSel').ikSelect({
    ddFullWidth: false,
    customClass: 'ikDate',
    autoWidth: false,
    ddMaxHeight: 200
  });
});